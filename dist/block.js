(()=>{"use strict";const e=window.wp.blocks,s=window.wp.i18n,o=window.wp.element,t=window.wp.components,l=window.wp.blockEditor,a=(0,o.forwardRef)((function({icon:e,size:s=24,...t},l){return(0,o.cloneElement)(e,{width:s,height:s,...t,ref:l})})),n=window.wp.primitives,i=window.ReactJSXRuntime,h=(0,i.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)(n.Path,{d:"M6 5.5h3a.5.5 0 01.5.5v3a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5zM4 6a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm11-.5h3a.5.5 0 01.5.5v3a.5.5 0 01-.5.5h-3a.5.5 0 01-.5-.5V6a.5.5 0 01.5-.5zM13 6a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2h-3a2 2 0 01-2-2V6zm5 8.5h-3a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5zM15 13a2 2 0 00-2 2v3a2 2 0 002 2h3a2 2 0 002-2v-3a2 2 0 00-2-2h-3zm-9 1.5h3a.5.5 0 01.5.5v3a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5zM4 15a2 2 0 012-2h3a2 2 0 012 2v3a2 2 0 01-2 2H6a2 2 0 01-2-2v-3z",fillRule:"evenodd",clipRule:"evenodd"})}),r=(0,i.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(n.Path,{d:"M4.75 4a.75.75 0 0 0-.75.75v7.826c0 .2.08.39.22.53l6.72 6.716a2.313 2.313 0 0 0 3.276-.001l5.61-5.611-.531-.53.532.528a2.315 2.315 0 0 0 0-3.264L13.104 4.22a.75.75 0 0 0-.53-.22H4.75ZM19 12.576a.815.815 0 0 1-.236.574l-5.61 5.611a.814.814 0 0 1-1.153 0L5.5 12.264V5.5h6.763l6.5 6.502a.816.816 0 0 1 .237.574ZM8.75 9.75a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"})}),c=(0,i.jsx)(n.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)(n.Path,{d:"M10 4.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zm2.25 7.5v-1A2.75 2.75 0 0011 8.25H7A2.75 2.75 0 004.25 11v1h1.5v-1c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v1h1.5zM4 20h9v-1.5H4V20zm16-4H4v-1.5h16V16z",fillRule:"evenodd",clipRule:"evenodd"})}),d=(0,i.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(n.Path,{d:"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z"})}),w=(0,i.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(n.Path,{d:"m14.5 6.5-1 1 3.7 3.7H4v1.6h13.2l-3.7 3.7 1 1 5.6-5.5z"})});(0,e.registerBlockType)("post-slideshow/slideshow-block",{apiVersion:3,title:"Post Slideshow",icon:"slides",category:"post-slideshow",attributes:{url:{type:"string",default:""},showTitle:{type:"boolean",default:!0},showExcerpt:{type:"boolean",default:!0},itemsInView:{type:"number",default:1},showCategories:{type:"boolean",default:!0},showTags:{type:"boolean",default:!0},showAuthor:{type:"boolean",default:!0},autoPlay:{type:"boolean",default:!0}},example:{attributes:{url:"https://rtcamp.com/",showTitle:!0,showExcerpt:!0,showAuthor:!1,showTags:!1,showCategories:!1,itemsInView:1,autoPlay:!1}},edit:e=>{const{attributes:n,setAttributes:p}=e,{url:x,showTitle:m,showExcerpt:u,itemsInView:g}=n,[b,j]=(0,o.useState)(!x),[_,v]=(0,o.useState)([]),[k,f]=(0,o.useState)(!1),[C,y]=(0,o.useState)(0),P=(0,l.useBlockProps)(),T=(0,o.useRef)(null),R=(0,o.useRef)(null),S=(0,o.useCallback)((e=>{p({url:e})}),[]),z=(0,o.useCallback)((()=>{j(!1),M(x)}),[x]),M=async e=>{if(e){f(!0);try{const o=await fetch(`${e}/wp-json/wp/v2/posts?_embed`),t=(await o.json()).map((e=>{const o=e._embedded?.["wp:featuredmedia"]?.[0]?.source_url||"",t=e._embedded?.["wp:term"]?.find((e=>e.some((e=>"category"===e.taxonomy))))||[],l=e._embedded?.["wp:term"]?.find((e=>e.some((e=>"post_tag"===e.taxonomy))))||[],a=e._embedded?.author?.[0]?.name||(0,s.__)("Unknown Author","post-slideshow-block");return{...e,featured_media_url:o,categories:t.map((e=>e.name)),tags:l.map((e=>e.name)),author:a}}));v(t)}catch(e){console.error((0,s.__)("Error fetching posts:","post-slideshow-block"),e)}finally{f(!1)}}},V=(0,o.useCallback)((()=>{const e=Math.max(0,_.length-g);y((s=>s<e?s+1:0))}),[_.length,g]),E=(0,o.useCallback)((()=>{const e=Math.max(0,_.length-g);y((s=>s>0?s-1:e))}),[_.length,g]),N=e=>(new DOMParser).parseFromString(e,"text/html").body.textContent||"";return(0,o.useEffect)((()=>{x&&M(x)}),[x]),(0,o.useEffect)((()=>{if(T.current&&R.current){const e=T.current.getBoundingClientRect();R.current.style.top=e.height/2+"px"}}),[_,k]),(0,o.useEffect)((()=>{let e;return n.autoPlay&&_.length>0&&(e=setInterval((()=>{V()}),1200)),()=>{e&&clearInterval(e)}}),[n.autoPlay,_.length,V]),(0,i.jsxs)("div",{...P,children:[(0,i.jsx)(l.BlockControls,{children:(0,i.jsx)(t.ToolbarGroup,{children:(0,i.jsx)(t.ToolbarButton,{icon:"edit",label:(0,s.__)("Edit URL","post-slideshow-block"),onClick:()=>j(!0)})})}),(0,i.jsxs)(l.InspectorControls,{children:[(0,i.jsxs)(t.PanelBody,{title:(0,s.__)("Slideshow Settings","post-slideshow-block"),initialOpen:!0,children:[(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.TextControl,{label:(0,s.__)("API URL","post-slideshow-block"),value:x,onChange:S,help:(0,s.__)("Enter the API URL to fetch posts from.","post-slideshow-block"),placeholder:"https://rtcamp.com/"})}),b&&(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.Button,{isPrimary:!0,onClick:z,disabled:k,children:(0,s.__)("Load Slideshow","post-slideshow-block")})}),(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Enable Autoplay","post-slideshow-block"),checked:n.autoPlay,onChange:()=>p({autoPlay:!n.autoPlay})})})]}),(0,i.jsxs)(t.PanelBody,{title:(0,s.__)("Content Display","post-slideshow-block"),initialOpen:!0,children:[(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Show Title","post-slideshow-block"),checked:n.showTitle,onChange:()=>p({showTitle:!n.showTitle})})}),(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Show Categories","post-slideshow-block"),checked:n.showCategories,onChange:()=>p({showCategories:!n.showCategories})})}),(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Show Tags","post-slideshow-block"),checked:n.showTags,onChange:()=>p({showTags:!n.showTags})})}),(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Show Author","post-slideshow-block"),checked:n.showAuthor,onChange:()=>p({showAuthor:!n.showAuthor})})}),(0,i.jsx)(t.PanelRow,{children:(0,i.jsx)(t.ToggleControl,{label:(0,s.__)("Show Excerpt","post-slideshow-block"),checked:n.showExcerpt,onChange:()=>p({showExcerpt:!n.showExcerpt})})})]}),(0,i.jsx)(t.PanelBody,{title:(0,s.__)("Layout Settings","post-slideshow-block"),initialOpen:!0,children:(0,i.jsx)(t.RangeControl,{label:(0,s.__)("Items in View","post-slideshow-block"),value:g,onChange:e=>p({itemsInView:e}),min:1,max:3,step:1,marks:!0,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})})]}),b?(0,i.jsxs)("div",{children:[(0,i.jsx)(t.TextControl,{label:(0,s.__)("Enter URL","post-slideshow-block"),value:x,onChange:S,placeholder:"https://rtcamp.com/"}),(0,i.jsx)(t.Button,{isPrimary:!0,onClick:z,children:(0,s.__)("Done","post-slideshow-block")})]}):k?(0,i.jsx)("p",{children:(0,s.__)("Loading...","post-slideshow-block")}):(0,i.jsxs)("div",{className:"slides-container",children:[(0,i.jsx)("div",{className:"slides",style:{transform:`translateX(-${100*C/g}%)`},children:_.map(((e,o)=>(0,i.jsxs)("div",{className:"slide "+(o>=C&&o<C+g?"active":""),style:{width:100/g+"%"},children:[(0,i.jsx)("div",{ref:T,className:"slide-image",style:{backgroundImage:`url(${e.featured_media_url})`,height:(1===g?400:2===g?300:200)+"px"}}),(0,i.jsxs)("div",{className:"slide-content",children:[m&&(0,i.jsx)("h3",{style:{fontSize:`${Math.max(12,22-2*g)}px`},children:N(e.title.rendered)}),n.showCategories&&e.categories.length>0&&(0,i.jsxs)("div",{className:"meta-info",children:[(0,i.jsx)(a,{icon:h}),e.categories.map((e=>(0,i.jsx)("span",{className:"meta-text",children:e},e)))]}),n.showTags&&e.tags.length>0&&(0,i.jsxs)("div",{className:"meta-info",children:[(0,i.jsx)(a,{icon:r}),e.tags.map((e=>(0,i.jsx)("span",{className:"meta-text",children:e},e)))]}),u&&(0,i.jsx)("p",{style:{fontSize:`${Math.max(12,20-2*g)}px`},children:N(e.excerpt.rendered)}),n.showAuthor&&(0,i.jsxs)("div",{className:"meta-info",children:[(0,i.jsx)(a,{icon:c}),(0,i.jsx)("span",{className:"meta-text",children:e.author})]})]}),(0,i.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"post-link",children:(0,i.jsx)("button",{className:"cta",children:(0,s.__)("Read More","post-slideshow-block")})})]},e.id)))}),(0,i.jsxs)("div",{ref:R,className:"controls",children:[(0,i.jsx)("button",{onClick:E,className:"prev-btn",children:(0,i.jsx)(a,{icon:d})}),(0,i.jsx)("button",{onClick:V,className:"next-btn",children:(0,i.jsx)(a,{icon:w})})]})]})]})},save:()=>null})})();